# DistributedBoundedSemaphore

## Общее назначение

`DistributedBoundedSemaphore` — это класс для управления распределённым ограниченным семафором, использующий Redis.
Класс расширяет функциональность `DistributedSemaphore` за счёт добавления ограничения на максимальное значение, до
которого может быть увеличено количество доступных "слотов". Это позволяет предотвратить ошибочное увеличение доступных
слотов выше изначально заданного максимума.

## Использование Redis

Как и базовый класс `DistributedSemaphore`, `DistributedBoundedSemaphore` использует Redis для хранения состояния
семафора. Однако, помимо ключа, указывающего на текущее количество доступных слотов, используется второй ключ для
хранения максимального значения семафора. LUA-скрипт для освобождения слотов учитывает это максимальное значение,
предотвращая увеличение количества слотов выше начального максимума.

## Методы класса

### `__init__(self, redis: 'Redis[Any]', key: str, value: int, acquire_sleep_delay: float = 0.1, acquire_timeout: float | None = None)`

Инициализирует экземпляр распределённого ограниченного семафора.

- `redis`: клиент Redis, который будет использоваться для семафора.
- `key`: ключ в Redis, используемый для хранения состояния семафора.
- `value`: начальное и максимальное количество слотов семафора.
- `acquire_sleep_delay`: задержка между попытками захвата слота семафора.
- `acquire_timeout`: максимальное время попыток захвата слота.

### `async _initialize_max_value(self) -> None`

Внутренний метод для инициализации максимального значения семафора в Redis, если оно ещё не было установлено.

### `async release(self) -> None`

Асинхронно освобождает слот семафора. Генерирует исключение `ValueError`, если попытка освобождения приведет к
увеличению количества слотов выше начального максимума.

## Примеры использования

1. **Управление доступом к ограниченным ресурсам в облачной инфраструктуре.** Используйте ограниченный семафор для
   контроля доступа к выделенным облачным ресурсам, таким как выделенные экземпляры серверов.
2. **Контроль за распределением лицензий.** Настройте семафор для управления числом одновременно используемых лицензий
   программного обеспечения.
3. **Регулирование доступа к ограниченным данным или сервисам.** Обеспечьте справедливый доступ к базам данных или API,
   которые не могут обрабатывать неограниченное количество запросов параллельно.

## Запуск примера

```
docker-compose build
docker-compose up
curl http://localhost:8090/gather_stats
```
